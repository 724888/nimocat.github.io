---
layout: post
title: 'Jekyll的深度定制和移动端优化'
subtitle: '深度定制你的主题'
date: 2018-02-08
categories: 技术
cover: 'https://www.swiftcoding.com/course/11/images/courses/frontend.jpg'
tags: jekyll 前端开发 移动端优化
---
# Jekyll的前端优化和移动端优化

## 项目定型

首先在这个项目确定下来的时候。我使用了Jekyll来进行我的博客创作。因为Jekyll比其他动态网页的优点是，可以部署在GIthub上面。能省一笔是一笔，也就省下了部署服务器的月钱。博客使用了[Kaeyleo](https://github.com/kaeyleo/jekyll-theme-H2O)老兄开发的主题，我觉得框架及其漂亮~（也是因为自己艺术细胞不够，设计不出来这么好看的东西）。所以在fork之后把hero的风格暂设计成水墨风格，配合暗色背景，也能很好的突出我名字的主旨，嘿嘿~（[天一生水的含义](https://www.zhihu.com/question/20518840)）

但接下来的问题就来了，由于引入了一系列设计风格和排版，如何做到既保证加载速度又在移动端上优化字体？在实现设计过程中遇到了如下问题：

1. Hero版面图片过大，加载过慢，无法覆盖移动端，以及移动端优化。
2. 字体文件过大，加载甚至需要20秒以上
3. 移动端字体风格与PC端的差距和风格问题
4. 节点优化与IPFS技术使用

接下来会对这些问题做个记录，方便日后有人使用主题时无法达到预期效果。

## Hero版面实现

在创作过程中，因为要配合米芾字体使用（可以去网上搜索米芾书法字体，非常适合排版），需要暗色Hero大图来作为主页使用。因为原主题图片较小，无额外字体文件，所以加载速度较快，那么需要实现加入Hero图片之后还能快速加载，至少需将Hero封面压缩至300kb左右，才能保证加载速度。

在网上也有相关压缩图片工具，推荐一个：[智图](http://zhitu.isux.us/)，可以在线压缩的同时能和原图进行对比，非常棒的功能。

所以我们首先进行布局：要在之前hero的基础上增加暗色背景并保证位置。有两种做法：

1. 在父类div中加入img并占据父组件100%高度
2. 在父类div上设置background

为了解释说明，我在主页上使用第一种方案，Tags页面使用第二种方案。

### img占据父组件

第一种解决方案的难点在于如何调节hero图片的位置，因为在移动端优化中，hero图片不能完全加载，导致会出现模糊或者比例不合适的情况·。针对这种情况使用``` height```, ```left```, ```top```三种属性调节。同时配合```@media screen```属性进行调节，如下：

````css
@media screen and (max-width: 376px) { 
    .home-banner {
        h2 {
            padding-top: 160px;
            font-size: 3.5em;
            line-height: 38px;
            padding-bottom: 5%
        }
        h3 {
            margin-top: 4px;
            font-size: 2.5em;
        }
        .header-img {
            width: 695px;
            left: -150px;
            height: 500px;
        }
    }
}
````

这是屏幕小于376的情况，属于iphone的适配，但在一些国产宽屏手机上，还是不能很好的显示。所以我们把主要改动属性写在```@media screen and (max-width: 500px) ```内，在max-width小于376时继承500的属性即可。代码详见dev/sass/layouts.sass。

而对```left```属性的规定主要影响hero的起始位置。这里我们规定起始位置为-150即向右偏移150px，此时大概最为合适。

***Tips：使用em作为单位，可以使字体在移动端适配效果更好。***

### 父组件设置background

第二种方式在tags页面用到：其主要好处是：可以对```background-position```属性进行严格控制，较```img```属性更为直观。这里```background-position```有两个值，第一个为左偏移度，第二个为右偏移度。所以代码大概如下：

````scss
#div {
    background-position: 50% 70%
}
````

含义就是：距离图片左端50%距离，距离图片上端70%距离。所以我们也能看得出来~图片相对的起始点是在左上角的，所以css偏移量计算都是以左上角为出发点~小技巧喔。之后还可以在Tags设置```text-shadow```属性来让Tags更具有水墨风格（在主页上并没有加，因为背景不够暗）详情属性可以在Chorme上打开```F12```调试工具查看。

***Tips：想在md中插入图片，上传到github repository后，在github打开图片，右键保存路径即可，其实也就是浏览器中的路径后面加```?raw=true```***

## 字体优化

因为系统自带字体加载迅速但不够美观，我们不想使用现代风格字体进行创作，所以我引入了[米芾书法字体](http://font.chinaz.com/Font_Preview.aspx?downloadid=1249100235361)作为首屏字体（字体超有力，超适合作为首屏！！墙裂推荐！！）但是我们会遇到一个大问题：**字体加载缓慢**！

几乎所有的网站静态资源加载，都要考虑到加载缓慢的问题，尤其在服务器处于外网的情况下，因为Bad Gateway而导致样式加载缓慢，或者浏览器异步加载，导致丑了吧唧的字体放在屏幕上半个小时才特喵加载成你想要的样子！这种情况非常多见，也是中文博客经常遇到的问题。

我引入了目前不太成熟的解决方案——[**字蛛插件**](http://font-spider.org/)

并不是说我挑剔，实在是字蛛的功能太单一而且具有极强局限性——只适用于静态网站！QAQ

因为他的工作原理为：

1. 搜索html文件中使用了```@font-face```的字体（也就是自定义字体）
2. 搜索所有html中用到此样式字体的标签
3. **搜集标签中的文字，删除不需要的文字**（这他喵就是坑爹啊！我网站更新了怎么办）
4. 替换原文字文件

所以...它只适用于静态网站，而且由于现代前端工程基本模块化实现，所以你还得先把font-face在index.html里定义一遍，让人家帮你删好之后再把font-face删掉，妈的…简直不是人，但这是最折衷的解决办法了。

因此我们可以把几M的字体文件压缩到十几KB，用起来，还是非常舒服的~
